<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ì–ª–∞–∑-–∫–ª–∏–∫–µ—Ä ‚úß</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
  body {
    margin:0;
    min-height:100vh;
    background:linear-gradient(135deg,#0f001a,#1a0033);
    font-family:system-ui,sans-serif;
    color:#f0e8ff;
    text-align:center;
    padding:20px;
  }
  h1 { font-size:3.5rem; margin:20px 0 30px; text-shadow:0 0 20px #603; }
  .eye-container { position:relative; width:300px; height:300px; margin:0 auto 40px; }
  .eye { width:100%; height:100%; border-radius:50%; position:relative; overflow:hidden; transition:all .25s ease; cursor:pointer; box-shadow:0 0 60px rgba(48,96,255,.7),inset 0 0 80px rgba(0,0,0,.4); }
  .eye:active:not(.low-energy) { transform:scale(0.94); }
  .pupil { width:120px; height:120px; background:#000814; border-radius:50%; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); box-shadow:inset 0 0 30px #000; }
  .highlight { width:44px; height:44px; background:white; border-radius:50%; position:absolute; top:30%; left:60%; opacity:.8; filter:blur(3px); }
  .stats { max-width:500px; margin:0 auto 30px; padding:20px; background:rgba(20,10,40,.6); border-radius:16px; border:1px solid #4a148c; }
  .energy-bar-container { width:100%; height:24px; background:#1a0033; border-radius:12px; overflow:hidden; border:2px solid #4a148c; }
  .energy-bar { height:100%; background:linear-gradient(90deg,#00e676,#76ff03); transition:width .6s ease; }
  .score { font-size:4.5rem; margin:15px 0 5px; text-shadow:0 0 25px #609; }
  .multiplier { font-size:1.4rem; color:#ffd700; margin-bottom:10px; }
  .prestige-btn { padding:14px 40px; font-size:1.3rem; background:#c62828; color:white; border:none; border-radius:30px; cursor:pointer; margin:20px auto; display:block; font-weight:bold; }
  .prestige-btn:disabled { background:#555; cursor:not-allowed; }
  .prestige-info { font-size:1.1rem; margin:10px 0; color:#ffeb3b; }
  .btn { padding:12px 28px; font-size:1.1rem; margin:12px 8px; border:none; border-radius:30px; cursor:pointer; font-weight:bold; transition:all .2s; }
  .btn-shop { background:#7b1fa2; color:white; }
  .btn-shop:hover { background:#9c27b0; transform:translateY(-2px); }
  .btn-ach { background:#ff6d00; color:white; }
  .btn-ach:hover { background:#ff8a33; transform:translateY(-2px); }
  #shop,#achievements,#prestige,#leaderboard { display:none; max-width:640px; margin:40px auto; padding:25px; background:rgba(20,10,40,.8); border-radius:16px; border:1px solid #7b1fa2; backdrop-filter:blur(8px); }
  .skin-grid,.ach-grid,.leaderboard-table { width:100%; border-collapse:collapse; margin-top:20px; }
  .skin-item,.ach-item { background:rgba(80,40,120,.4); border:2px solid transparent; border-radius:12px; padding:15px; text-align:center; transition:all .2s; }
  .skin-item:hover,.ach-item:hover { background:rgba(100,60,140,.6); }
  .skin-item.owned { border-color:#00e676; }
  .skin-item.current { border-color:#ffeb3b; box-shadow:0 0 15px #ffeb3b80; }
  .ach-item.completed { border-color:#ffd54f; background:rgba(255,215,79,.15); }
  .skin-item .preview { width:120px; height:120px; margin:0 auto 12px; border-radius:50%; }
  .ach-item .icon { font-size:3.2rem; margin-bottom:10px; }
  .buy-btn { margin-top:10px; padding:8px 16px; border:none; border-radius:20px; background:#4caf50; color:white; font-weight:bold; cursor:pointer; }
  .buy-btn:disabled { background:#555; cursor:not-allowed; }
  .low-energy { filter:brightness(0.4) saturate(0.3); cursor:not-allowed; }

  /* –ü—Ä–æ–º–æ–∫–æ–¥—ã */
  .promo-toggle-btn { position:fixed; top:20px; right:20px; padding:10px 18px; font-size:1rem; background:#7b1fa2; color:white; border:none; border-radius:30px; cursor:pointer; box-shadow:0 4px 15px rgba(123,31,162,.5); z-index:1000; transition:all .2s; }
  .promo-toggle-btn:hover { background:#9c27b0; transform:translateY(-2px); }
  .promo-box { display:none; position:fixed; top:70px; right:20px; width:340px; padding:20px; background:rgba(40,20,80,.95); border-radius:16px; border:1px solid #7b1fa2; box-shadow:0 8px 30px rgba(0,0,0,.7); z-index:999; }

  /* –ù–∏–∫–Ω–µ–π–º */
  #nickname-modal {
    position:fixed; inset:0; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:2000;
  }
  .modal-content {
    background:rgba(40,20,80,0.95); padding:40px; border-radius:16px; border:2px solid #7b1fa2; text-align:center; max-width:400px;
  }
  .modal-content input {
    padding:12px; font-size:1.2rem; width:80%; margin:20px 0; border-radius:8px; border:none; background:#1a0033; color:white;
  }
  .modal-content button {
    padding:12px 40px; font-size:1.2rem; background:#4caf50; color:white; border:none; border-radius:30px; cursor:pointer;
  }
</style>
</head>
<body>

<!-- –ù–∏–∫–Ω–µ–π–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ -->
<div id="nickname-modal">
  <div class="modal-content">
    <h2>–ü—Ä–∏–≤–µ—Ç! –í–≤–µ–¥–∏ —Å–≤–æ–π –Ω–∏–∫</h2>
    <p>–û–Ω –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤</p>
    <input type="text" id="nickname-input" placeholder="–¢–≤–æ–π –Ω–∏–∫..." maxlength="16">
    <br>
    <button id="save-nickname">–ù–∞—á–∞—Ç—å!</button>
  </div>
</div>

<div class="main-content">
  <h1>–ì–ª–∞–∑-–∫–ª–∏–∫–µ—Ä</h1>

  <div class="eye-container">
    <div class="eye" id="eye">
      <div class="pupil"></div>
      <div class="highlight"></div>
      <div class="no-energy-text" id="noEnergyMsg">–≠–Ω–µ—Ä–≥–∏—è –∏—Å—á–µ—Ä–ø–∞–Ω–∞<br>–û–∂–∏–¥–∞–π—Ç–µ 5 –º–∏–Ω</div>
    </div>
  </div>

  <div class="score" id="score">0</div>
  <div class="multiplier" id="multiplier">√ó1</div>

  <div class="stats">
    <div class="energy-bar-container">
      <div class="energy-bar" id="energyBar"></div>
    </div>
    <div style="margin-top:12px; color:#b0ffcc; font-size:1.3rem;">
      –≠–Ω–µ—Ä–≥–∏—è: <span id="energyText">100 / 100</span>
    </div>
  </div>

  <div>
    <button class="btn btn-shop" id="toggleShop">–ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="btn btn-ach" id="toggleAch">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
    <button class="btn prestige-btn" id="togglePrestige">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</button>
    <button class="btn btn-ach" id="toggleLeaderboard" style="background:#0288d1;">–õ–∏–¥–µ—Ä—ã</button>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shop">
    <h2>–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h2>
    <div class="skin-grid" id="skinGrid"></div>
    <button class="btn btn-shop" id="closeShop" style="margin-top:25px; background:#d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
  <div id="achievements">
    <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
    <div class="ach-grid" id="achGrid"></div>
    <button class="btn btn-ach" id="closeAch" style="margin-top:25px; background:#ff8a33;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è -->
  <div id="prestige">
    <h2>–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</h2>
    <p class="prestige-info">–¢–µ–∫—É—â–µ–µ: <span id="currentPrestige">0</span></p>
    <p class="prestige-info">–°–ª–µ–¥—É—é—â–∏–π: √ó<span id="nextMultiplier">2</span> –∑–∞ –∫–ª–∏–∫</p>
    <button class="prestige-btn" id="doPrestige" disabled>–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è</button>
    <p id="prestigeStatus" style="margin-top:15px; color:#ffeb3b;"></p>
    <button class="btn btn-shop" id="closePrestige" style="margin-top:20px; background:#d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
  <div id="leaderboard">
    <h2>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
    <table class="leaderboard-table">
      <thead>
        <tr style="background:#4a148c;">
          <th style="padding:12px;">–ú–µ—Å—Ç–æ</th>
          <th style="padding:12px;">–ò–≥—Ä–æ–∫</th>
          <th style="padding:12px;">–û—á–∫–∏</th>
        </tr>
      </thead>
      <tbody id="leaderboard-body"></tbody>
    </table>
    <button class="btn btn-shop" id="closeLeaderboard" style="margin-top:25px; background:#d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ü—Ä–æ–º–æ–∫–æ–¥—ã -->
<button class="promo-toggle-btn" id="togglePromo">–ü—Ä–æ–º–æ–∫–æ–¥</button>

<div class="promo-box" id="promoBox">
  <h3>–í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥</h3>
  <input type="text" id="promoInput" class="promo-input" placeholder="–í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥">
  <button class="promo-btn" id="activatePromo">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  <div id="promoResult" class="promo-result"></div>
</div>

<script>
// =============================================
// –ù–ò–ö–ù–ï–ô–ú + –õ–ò–î–ï–†–ë–û–†–î
// =============================================
const nicknameModal = document.getElementById('nickname-modal');
const nicknameInput = document.getElementById('nickname-input');
const saveNicknameBtn = document.getElementById('save-nickname');

let playerName = localStorage.getItem('playerNickname');

if (!playerName) {
  nicknameModal.style.display = 'flex';
} else {
  nicknameModal.style.display = 'none';
}

saveNicknameBtn.addEventListener('click', () => {
  const name = nicknameInput.value.trim();
  if (name.length < 2 || name.length > 16) {
    alert('–ù–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 2 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤!');
    return;
  }
  playerName = name;
  localStorage.setItem('playerNickname', playerName);
  nicknameModal.style.display = 'none';
  updateLeaderboard();
});

// =============================================
// –õ–ò–î–ï–†–ë–û–†–î
// =============================================
function updateLeaderboard() {
  let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];

  if (playerName && score > 0) {
    const existing = leaderboard.find(e => e.name === playerName);
    if (existing) {
      if (score > existing.score) existing.score = score;
    } else {
      leaderboard.push({ name: playerName, score });
    }

    leaderboard.sort((a, b) => b.score - a.score);
    if (leaderboard.length > 10) leaderboard.length = 10;

    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
  }

  const tbody = document.getElementById('leaderboard-body');
  tbody.innerHTML = '';
  leaderboard.forEach((entry, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="padding:12px;border-bottom:1px solid #7b1fa2;">${i+1}</td>
      <td style="padding:12px;border-bottom:1px solid #7b1fa2;">${entry.name}</td>
      <td style="padding:12px;border-bottom:1px solid #7b1fa2;">${entry.score.toLocaleString()}</td>
    `;
    tbody.appendChild(tr);
  });
}

// =============================================
// –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
// =============================================
const SKINS = [
  { id: "default", name: "–ö–ª–∞—Å—Å–∏–∫–∞", price: 0, bg: "radial-gradient(circle at 40% 40%, #fff 0%, #d0e8ff 30%, #80b0ff 60%, #3060ff 100%)" },
  { id: "fire", name: "–ü–ª–∞–º—è", price: 250, bg: "radial-gradient(circle at 40% 40%, #fff, #ffe082 20%, #ff9800 50%, #d50000 90%)" },
  { id: "void", name: "–ü—É—Å—Ç–æ—Ç–∞", price: 400, bg: "radial-gradient(circle at 40% 40%, #111, #1a0033 30%, #4a148c 60%, #000 100%)" },
  { id: "toxic", name: "–Ø–¥–æ–≤–∏—Ç—ã–π", price: 600, bg: "radial-gradient(circle at 40% 40%, #e0f2f1, #b2dfdb 30%, #009688 60%, #004d40 100%)" },
  { id: "neon", name: "–ù–µ–æ–Ω", price: 1200, bg: "radial-gradient(circle at 40% 40%, #fff, #e91e63 30%, #00e5ff 60%, #000 100%)" },
  { id: "gold", name: "–ó–æ–ª–æ—Ç–æ–π", price: 2500, bg: "radial-gradient(circle at 40% 40%, #fff, #fff176 30%, #ffc107 60%, #ff8f00 100%)" },
  { id: "2026", name: "–†–æ–∂–¥–µ—Å—Ç–≤–æ", price: "–ü—Ä–æ–º–æ–∫–æ–¥", bg: "radial-gradient(circle at 40% 40%, #ff004d 0%, #ff4d00 30%, #0066ff 60%, #0033aa 100%)" }
];

const ACHIEVEMENTS = [
  { id: "clicks_100", name: "–ù–æ–≤–∏—á–æ–∫", desc: "–°–¥–µ–ª–∞—Ç—å 100 –∫–ª–∏–∫–æ–≤", icon: "‚úä", target: 100 },
  { id: "clicks_1000", name: "–£–¥–∞—Ä–Ω–∏–∫", desc: "1000 –∫–ª–∏–∫–æ–≤", icon: "üí™", target: 1000 },
  { id: "clicks_5000", name: "–ë–µ–∑—É–º–Ω—ã–π –∫–ª–∏–∫–µ—Ä", desc: "5000 –∫–ª–∏–∫–æ–≤", icon: "üî•", target: 5000 },
  { id: "clicks_20000", name: "–õ–µ–≥–µ–Ω–¥–∞ –≥–ª–∞–∑–∞", desc: "20 000 –∫–ª–∏–∫–æ–≤", icon: "üåü", target: 20000 },
  { id: "skins_3", name: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä", desc: "–ö—É–ø–∏—Ç—å 3 —Å–∫–∏–Ω–∞", icon: "üõçÔ∏è", target: 3, type: "skins" },
  { id: "energy_full", name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫", desc: "–ù–∞–∫–æ–ø–∏—Ç—å 100 —ç–Ω–µ—Ä–≥–∏–∏", icon: "‚ö°", target: 100, type: "energy" }
];

const PROMOCODES = {
  "defynet": { description: "–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è!", effect: () => energy = Infinity },
  "test2025": { description: "+500 –æ—á–∫–æ–≤!", effect: () => score += 500 },
  "skinfire": { description: "–°–∫–∏–Ω ¬´–ü–ª–∞–º—è¬ª –±–µ—Å–ø–ª–∞—Ç–Ω–æ!", effect: () => { if (!ownedSkins.includes("fire")) { ownedSkins.push("fire"); currentSkin = "fire"; applySkin(); renderShop(); } } },
  "def2025": { description: "1 000 000 –æ—á–∫–æ–≤!", effect: () => score += 1000000 },
  "2026": { description: "–°–∫–∏–Ω ¬´–†–æ–∂–¥–µ—Å—Ç–≤–æ¬ª –ø–æ–ª—É—á–µ–Ω!", effect: () => { if (!ownedSkins.includes("2026")) { ownedSkins.push("2026"); currentSkin = "2026"; applySkin(); renderShop(); } } },
  "67": { description: "+10 000 000 –æ—á–∫–æ–≤!", effect: () => score += 10000000 }
};

const BASE_PRESTIGE_POINTS = 10000;
const PRESTIGE_LEVELS = 5;

const STORAGE = {
  score: 'eyeClickerScore',
  energy: 'eyeClickerEnergy',
  lastTime: 'eyeClickerLastTime',
  owned: 'eyeClickerOwnedSkins',
  current: 'eyeClickerCurrentSkin',
  progress: 'eyeClickerAchProgress',
  completed: 'eyeClickerAchCompleted',
  usedPromos: 'eyeClickerUsedPromos',
  prestige: 'eyeClickerPrestige',
  clickMultiplier: 'eyeClickerMultiplier'
};

let score = Number(localStorage.getItem(STORAGE.score)) || 0;
let energy = Number(localStorage.getItem(STORAGE.energy)) || 100;
let lastTime = Number(localStorage.getItem(STORAGE.lastTime)) || Date.now();
let ownedSkins = JSON.parse(localStorage.getItem(STORAGE.owned)) || ["default"];
let currentSkin = localStorage.getItem(STORAGE.current) || "default";
let achProgress = JSON.parse(localStorage.getItem(STORAGE.progress)) || {};
let completed = new Set(JSON.parse(localStorage.getItem(STORAGE.completed)) || []);
let usedPromos = new Set(JSON.parse(localStorage.getItem(STORAGE.usedPromos)) || []);
let prestigeLevel = Number(localStorage.getItem(STORAGE.prestige)) || 0;
let clickMultiplier = Number(localStorage.getItem(STORAGE.clickMultiplier)) || 1;

const MAX_ENERGY = 100;

energy = Math.min(MAX_ENERGY, energy + Math.floor((Date.now() - lastTime) / 1000 / 300));

const eye = document.getElementById('eye');
const scoreEl = document.getElementById('score');
const multiplierEl = document.getElementById('multiplier');
const energyBar = document.getElementById('energyBar');
const energyText = document.getElementById('energyText');
const noEnergyMsg = document.getElementById('noEnergyMsg');
const promoInput = document.getElementById('promoInput');
const activateBtn = document.getElementById('activatePromo');
const promoResult = document.getElementById('promoResult');
const promoBox = document.getElementById('promoBox');
const togglePromo = document.getElementById('togglePromo');
const shop = document.getElementById('shop');
const achPanel = document.getElementById('achievements');
const prestigePanel = document.getElementById('prestige');
const leaderboardPanel = document.getElementById('leaderboard');
const skinGrid = document.getElementById('skinGrid');
const achGrid = document.getElementById('achGrid');
const btnShop = document.getElementById('toggleShop');
const btnCloseShop = document.getElementById('closeShop');
const btnAch = document.getElementById('toggleAch');
const btnCloseAch = document.getElementById('closeAch');
const btnPrestige = document.getElementById('togglePrestige');
const btnClosePrestige = document.getElementById('closePrestige');
const doPrestigeBtn = document.getElementById('doPrestige');
const prestigeStatus = document.getElementById('prestigeStatus');
const currentPrestigeEl = document.getElementById('currentPrestige');
const nextMultiplierEl = document.getElementById('nextMultiplier');
const btnLeaderboard = document.getElementById('toggleLeaderboard');
const btnCloseLeaderboard = document.getElementById('closeLeaderboard');

// =============================================
// –ü–ï–†–ï–†–ï–ñ–î–ï–ù–ò–Ø
// =============================================
function getRequiredPointsForLevel(level) {
  return BASE_PRESTIGE_POINTS * Math.pow(2, level);
}

function updatePrestigeUI() {
  currentPrestigeEl.textContent = prestigeLevel;
  multiplierEl.textContent = `√ó${clickMultiplier}`;

  if (prestigeLevel >= PRESTIGE_LEVELS) {
    doPrestigeBtn.disabled = true;
    prestigeStatus.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!';
    return;
  }

  const nextLevel = prestigeLevel + 1;
  const required = getRequiredPointsForLevel(nextLevel - 1);
  nextMultiplierEl.textContent = nextLevel + 1;

  const firstTwoDone = ACHIEVEMENTS.slice(0, 2).every(ach => completed.has(ach.id));
  doPrestigeBtn.disabled = score < required || !firstTwoDone;

  prestigeStatus.textContent = doPrestigeBtn.disabled
    ? `–ù—É–∂–Ω–æ ${required.toLocaleString()} –æ—á–∫–æ–≤ + 2 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è`
    : '–ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è';
}

doPrestigeBtn.addEventListener('click', () => {
  if (doPrestigeBtn.disabled) return;

  prestigeLevel++;
  clickMultiplier++;
  score = 0;
  energy = MAX_ENERGY;
  localStorage.setItem(STORAGE.prestige, prestigeLevel);
  localStorage.setItem(STORAGE.clickMultiplier, clickMultiplier);

  updateUI();
  updatePrestigeUI();
  prestigeStatus.textContent = `–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ ${prestigeLevel} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –¢–µ–ø–µ—Ä—å √ó${clickMultiplier} –∑–∞ –∫–ª–∏–∫`;
  setTimeout(() => prestigeStatus.textContent = '', 5000);
});

// =============================================
// –ü–†–û–ú–û–ö–û–î–´
// =============================================
togglePromo.addEventListener('click', () => {
  promoBox.style.display = promoBox.style.display === 'block' ? 'none' : 'block';
});

activateBtn.addEventListener('click', () => {
  const code = promoInput.value.trim().toLowerCase();
  if (!code) return;

  if (code === "67") {
    score += 10000000;
    saveProgress();
    updateUI();
    promoResult.className = 'promo-result success';
    promoResult.textContent = '+10 000 000 –æ—á–∫–æ–≤! –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ';
  } else if (usedPromos.has(code)) {
    promoResult.className = 'promo-result error';
    promoResult.textContent = '–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!';
  } else if (PROMOCODES[code]) {
    PROMOCODES[code].effect();
    usedPromos.add(code);
    saveProgress();
    updateUI();
    promoResult.className = 'promo-result success';
    promoResult.textContent = PROMOCODES[code].description;
  } else {
    promoResult.className = 'promo-result error';
    promoResult.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥';
  }

  promoInput.value = '';
  setTimeout(() => promoResult.textContent = '', 5000);
});

// =============================================
// –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î
// =============================================
function saveProgress() {
  localStorage.setItem(STORAGE.score, score);
  localStorage.setItem(STORAGE.energy, energy);
  localStorage.setItem(STORAGE.lastTime, Date.now());
  localStorage.setItem(STORAGE.owned, JSON.stringify(ownedSkins));
  localStorage.setItem(STORAGE.current, currentSkin);
  localStorage.setItem(STORAGE.progress, JSON.stringify(achProgress));
  localStorage.setItem(STORAGE.completed, JSON.stringify([...completed]));
  localStorage.setItem(STORAGE.usedPromos, JSON.stringify([...usedPromos]));
}

function applySkin() {
  const skin = SKINS.find(s => s.id === currentSkin) || SKINS[0];
  eye.style.background = skin.bg;
}

function updateUI() {
  scoreEl.textContent = score.toLocaleString();
  const percent = (energy / MAX_ENERGY) * 100;
  energyBar.style.width = percent + '%';
  energyText.textContent = `${Math.floor(energy)} / ${MAX_ENERGY}`;

  eye.classList.toggle('low-energy', energy <= 0);
  noEnergyMsg.style.opacity = energy <= 0 ? '1' : '0';

  applySkin();
  updateLeaderboard(); // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—á–∫–æ–≤
}

function renderShop() {
  skinGrid.innerHTML = '';
  SKINS.forEach(skin => {
    const item = document.createElement('div');
    item.className = 'skin-item';
    if (ownedSkins.includes(skin.id)) item.classList.add('owned');
    if (currentSkin === skin.id) item.classList.add('current');

    const preview = document.createElement('div');
    preview.className = 'preview';
    preview.style.background = skin.bg;

    const name = document.createElement('div');
    name.textContent = skin.name;

    const price = document.createElement('div');
    price.textContent = skin.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : (skin.price === "–ü—Ä–æ–º–æ–∫–æ–¥" ? "–ü—Ä–æ–º–æ–∫–æ–¥" : `${skin.price} –æ—á–∫–æ–≤`);

    const btn = document.createElement('button');
    btn.className = 'buy-btn';

    if (ownedSkins.includes(skin.id)) {
      btn.textContent = currentSkin === skin.id ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å';
      btn.disabled = currentSkin === skin.id;
      btn.onclick = () => {
        currentSkin = skin.id;
        updateUI();
        renderShop();
        saveProgress();
      };
    } else if (skin.price !== "–ü—Ä–æ–º–æ–∫–æ–¥") {
      btn.textContent = `–ö—É–ø–∏—Ç—å (${skin.price})`;
      btn.disabled = score < skin.price;
      btn.onclick = () => {
        if (score >= skin.price) {
          score -= skin.price;
          ownedSkins.push(skin.id);
          currentSkin = skin.id;
          updateUI();
          renderShop();
          saveProgress();
        }
      };
    } else {
      btn.textContent = '–ü—Ä–æ–º–æ–∫–æ–¥';
      btn.disabled = true;
    }

    item.append(preview, name, price, btn);
    skinGrid.appendChild(item);
  });
}

function renderAchievements() {
  achGrid.innerHTML = '';
  ACHIEVEMENTS.forEach(ach => {
    const item = document.createElement('div');
    item.className = 'ach-item';
    if (completed.has(ach.id)) item.classList.add('completed');

    const icon = document.createElement('div');
    icon.className = 'icon';
    icon.textContent = ach.icon;

    const name = document.createElement('div');
    name.textContent = ach.name;
    name.style.fontWeight = 'bold';

    const desc = document.createElement('div');
    desc.textContent = ach.desc;
    desc.style.fontSize = '0.9rem';
    desc.style.opacity = '0.85';

    const progress = document.createElement('div');
    progress.style.marginTop = '10px';
    progress.style.fontSize = '0.95rem';

    if (completed.has(ach.id)) {
      progress.textContent = '‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
      progress.style.color = '#ffd54f';
    } else {
      let val = achProgress[ach.id] || 0;
      progress.textContent = `${val.toLocaleString()} / ${ach.target.toLocaleString()}`;
      progress.style.color = '#b0bec5';
    }

    item.append(icon, name, desc, progress);
    achGrid.appendChild(item);
  });
}

// –°–û–ë–´–¢–ò–Ø
eye.addEventListener('click', () => {
  if (energy > 0) {
    score += clickMultiplier;
    energy--;
    updateUI();
    saveProgress();
    if (navigator.vibrate) navigator.vibrate(12);
  }
});

btnShop.onclick = () => { shop.style.display = 'block'; btnShop.style.display = 'none'; renderShop(); };
btnCloseShop.onclick = () => { shop.style.display = 'none'; btnShop.style.display = 'inline-block'; };

btnAch.onclick = () => { achPanel.style.display = 'block'; btnAch.style.display = 'none'; renderAchievements(); };
btnCloseAch.onclick = () => { achPanel.style.display = 'none'; btnAch.style.display = 'inline-block'; };

btnPrestige.onclick = () => { prestigePanel.style.display = 'block'; btnPrestige.style.display = 'none'; updatePrestigeUI(); };
btnClosePrestige.onclick = () => { prestigePanel.style.display = 'none'; btnPrestige.style.display = 'inline-block'; };

btnLeaderboard.onclick = () => {
  updateLeaderboard();
  leaderboardPanel.style.display = 'block';
};

btnCloseLeaderboard.onclick = () => {
  leaderboardPanel.style.display = 'none';
};

// –¢–ê–ô–ú–ï–†–´
setInterval(saveProgress, 8000);
setInterval(() => {
  if (energy < MAX_ENERGY) {
    energy += 1;
    updateUI();
    saveProgress();
  }
}, 3000);

// –°–¢–ê–†–¢
updateUI();
renderShop();
renderAchievements();
updatePrestigeUI();
</script>
</body>
</html>
