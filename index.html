<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ì–ª–∞–∑-–∫–ª–∏–∫–µ—Ä ‚úß</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
  body {
    margin:0;
    min-height:100vh;
    font-family:system-ui,sans-serif;
    color:#f0e8ff;
    text-align:center;  
    padding:20px;
    position: relative;
    overflow-x: hidden;
  }

  /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
  .animated-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    background: linear-gradient(135deg, #0f001a 0%, #1a0033 25%, #2d004d 50%, #1a0033 75%, #0f001a 100%);
    background-size: 400% 400%;
    animation: gradientShift 20s ease infinite;
  }

  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* –ü–ª–∞–≤–∞—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  .particle {
    position: absolute;
    border-radius: 50%;
    opacity: 0.3;
    animation: float linear infinite;
  }

  @keyframes float {
    0% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
    25% { opacity: 0.5; }
    50% { opacity: 0.3; }
    75% { opacity: 0.5; }
    100% { transform: translateY(-100vh) rotate(360deg); opacity: 0.3; }
  }

  /* –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–µ —Å—Ñ–µ—Ä—ã */
  .pulsing-spheres {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  .sphere {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(123, 31, 162, 0.2), transparent 70%);
    filter: blur(40px);
    animation: pulseSphere 8s ease-in-out infinite;
  }

  @keyframes pulseSphere {
    0%, 100% { transform: scale(1); opacity: 0.3; }
    50% { transform: scale(1.2); opacity: 0.5; }
  }

  /* –ú–µ—Ä—Ü–∞—é—â–∏–µ –∑–≤–µ–∑–¥—ã */
  .stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  .star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: twinkle 3s infinite;
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  /* –í—Ä–∞—â–∞—é—â–∏–µ—Å—è —Å–ø–∏—Ä–∞–ª–∏ */
  .spirals {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
    opacity: 0.1;
  }

  .spiral {
    position: absolute;
    width: 300px;
    height: 300px;
    border: 1px solid rgba(123, 31, 162, 0.3);
    border-radius: 50%;
    animation: rotateSpiral 40s linear infinite;
  }

  .spiral:nth-child(2) {
    width: 500px;
    height: 500px;
    border-color: rgba(76, 175, 80, 0.2);
    animation-duration: 60s;
    animation-direction: reverse;
  }

  .spiral:nth-child(3) {
    width: 700px;
    height: 700px;
    border-color: rgba(255, 152, 0, 0.2);
    animation-duration: 80s;
  }

  @keyframes rotateSpiral {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
    100% { transform: rotate(360deg) scale(1); }
  }

  h1 { font-size:3.5rem; margin:20px 0 30px; text-shadow:0 0 20px #603; position: relative; z-index: 1; }
  .eye-container { position:relative; width:300px; height:300px; margin:0 auto 40px; z-index: 1; }
  .eye { width:100%; height:100%; border-radius:50%; position:relative; overflow:hidden; transition:all .25s ease; cursor:pointer; box-shadow:0 0 60px rgba(48,96,255,.7),inset 0 0 80px rgba(0,0,0,.4); }
  .eye:active:not(.low-energy) { transform:scale(0.94); }
  .pupil { width:120px; height:120px; background:#000814; border-radius:50%; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); box-shadow:inset 0 0 30px #000; }
  .highlight { width:44px; height:44px; background:white; border-radius:50%; position:absolute; top:30%; left:60%; opacity:.8; filter:blur(3px); }
  .stats { max-width:500px; margin:0 auto 30px; padding:20px; background:rgba(20,10,40,.6); border-radius:16px; border:1px solid #4a148c; backdrop-filter:blur(10px); position: relative; z-index: 1; }
  .energy-bar-container { width:100%; height:24px; background:#1a0033; border-radius:12px; overflow:hidden; border:2px solid #4a148c; }
  .energy-bar { height:100%; background:linear-gradient(90deg,#00e676,#76ff03); transition:width .6s ease; }
  .score { font-size:4.5rem; margin:15px 0 5px; text-shadow:0 0 25px #609; position: relative; z-index: 1; }
  .multiplier { font-size:1.4rem; color:#ffd700; margin-bottom:10px; position: relative; z-index: 1; }
  .prestige-btn { padding:14px 40px; font-size:1.3rem; background:#c62828; color:white; border:none; border-radius:30px; cursor:pointer; margin:20px auto; display:block; font-weight:bold; position: relative; z-index: 1; }
  .prestige-btn:disabled { background:#555; cursor:not-allowed; }
  .prestige-info { font-size:1.1rem; margin:10px 0; color:#ffeb3b; }
  .btn { padding:12px 28px; font-size:1.1rem; margin:12px 8px; border:none; border-radius:30px; cursor:pointer; font-weight:bold; transition:all .2s; position: relative; z-index: 1; }
  .btn-shop { background:#7b1fa2; color:white; }
  .btn-shop:hover { background:#9c27b0; transform:translateY(-2px); }
  .btn-ach { background:#ff6d00; color:white; }
  .btn-ach:hover { background:#ff8a33; transform:translateY(-2px); }
  .btn-draw { background:#00bfa5; color:white; }
  .btn-draw:hover { background:#00d6b2; transform:translateY(-2px); }
  #shop,#achievements,#prestige { display:none; max-width:640px; margin:40px auto; padding:25px; background:rgba(20,10,40,.8); border-radius:16px; border:1px solid #7b1fa2; backdrop-filter:blur(15px); position: relative; z-index: 1; }
  .draw-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); backdrop-filter:blur(12px); z-index:2000; align-items:center; justify-content:center; }
  .draw-modal.active { display:flex; }
  .draw-modal-content { background:linear-gradient(135deg,#1a0033,#2d004d,#1a0033); border:2px solid #7b1fa2; border-radius:20px; padding:20px; text-align:center; box-shadow:0 0 80px rgba(123,31,162,.6); }
  #drawCanvas { border-radius:50%; cursor:crosshair; border: 2px solid #7b1fa2; }
  .draw-controls { margin-top:20px; display:flex; flex-wrap: wrap; justify-content:center; align-items:center; gap:15px; color: white;}
  .draw-controls > label { font-size: 1.1rem; }
  .skin-grid,.ach-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(170px,1fr)); gap:20px; margin-top:25px; }
  .skin-item,.ach-item { background:rgba(80,40,120,.4); border:2px solid transparent; border-radius:12px; padding:15px; text-align:center; transition:all .2s; }
  .skin-item:hover,.ach-item:hover { background:rgba(100,60,140,.6); }
  .skin-item.owned { border-color:#00e676; }
  .skin-item.current { border-color:#ffeb3b; box-shadow:0 0 15px #ffeb3b80; }
  .ach-item.completed { border-color:#ffd54f; background:rgba(255,215,79,.15); }
  .skin-item .preview { width:120px; height:120px; margin:0 auto 12px; border-radius:50%; }
  .ach-item .icon { font-size:3.2rem; margin-bottom:10px; }
  .buy-btn { margin-top:10px; padding:8px 16px; border:none; border-radius:20px; background:#4caf50; color:white; font-weight:bold; cursor:pointer; }
  .buy-btn:disabled { background:#555; cursor:not-allowed; }
  .low-energy { filter:brightness(0.4) saturate(0.3); cursor:not-allowed; }
  .no-energy-text { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#ff5252; font-size:1.4rem; font-weight:bold; text-shadow:0 0 15px #d50000; pointer-events:none; opacity:0; transition:opacity .6s; }

  /* –ü—Ä–æ–º–æ–∫–æ–¥—ã */
  .promo-toggle-btn { position:fixed; top:20px; right:20px; padding:12px 24px; font-size:1.1rem; background:#7b1fa2; color:white; border:none; border-radius:30px; cursor:pointer; box-shadow:0 4px 15px rgba(123,31,162,.5); z-index:1000; transition:all .2s; }
  .promo-toggle-btn:hover { background:#9c27b0; transform:translateY(-2px); }
  .promo-box { display:none; position:fixed; top:80px; right:20px; width:340px; padding:20px; background:rgba(40,20,80,.95); border-radius:16px; border:1px solid #7b1fa2; box-shadow:0 8px 30px rgba(0,0,0,.7); z-index:999; }

  /* –†—É–ª–µ—Ç–∫–∞ –∫–µ–π—Å–æ–≤ - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
  .case-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); backdrop-filter:blur(12px); z-index:2000; align-items:center; justify-content:center; }
  .case-modal.active { display:flex; }
  .case-modal-content { background:linear-gradient(135deg,#1a0033,#2d004d,#1a0033); border:2px solid #ffd700; border-radius:40px; padding:60px 80px; text-align:center; box-shadow:0 0 80px rgba(255,215,0,.6),inset 0 0 40px rgba(255,215,0,.1); animation:scaleIn 0.5s ease-out; }
  @keyframes scaleIn { from { transform:scale(0.8); opacity:0; } to { transform:scale(1); opacity:1; } }
  .case-roulette { font-size:12rem; font-weight:900; color:#ffd700; text-shadow:0 0 40px #ff8c00,0 0 80px #ff6b00,0 0 120px #ff4500; letter-spacing:20px; min-height:180px; display:flex; align-items:center; justify-content:center; font-family:monospace; }
  .roulette-rolling { animation:spin2d 0.15s linear infinite; }
  @keyframes spin2d { 0% { transform:scale(1) rotate(0deg); } 50% { transform:scale(1.05); } 100% { transform:scale(1) rotate(360deg); } }
  .case-modal-label { font-size:2.5rem; color:#ffeb3b; margin-bottom:30px; text-shadow:0 0 20px #ffeb3b; font-weight:bold; }
  .case-modal-result { font-size:1.8rem; color:#76ff03; margin-top:40px; text-shadow:0 0 15px #76ff03; font-weight:bold; }
  .case-modal-glow { position:absolute; inset:0; border-radius:40px; background:linear-gradient(45deg,transparent,rgba(255,215,0,.2),transparent); border:2px solid transparent; border-image:linear-gradient(45deg,transparent,#ffd700,transparent) 1; animation:glowPulse 2s ease-in-out infinite; pointer-events:none; }
  @keyframes glowPulse { 0%, 100% { opacity:0.3; } 50% { opacity:1; } }

  /* –†–∞–¥—É–∂–Ω—ã–π —Å–∫–∏–Ω */
  .rainbow-eye { animation:rainbowShift 8s ease-in-out infinite; }
  @keyframes rainbowShift {
    0% { background:radial-gradient(circle at 40% 40%, #fff, #ff0000 30%, #ff7700 60%, #ff0000 100%); }
    8% { background:radial-gradient(circle at 40% 40%, #fff, #ff3300 30%, #ff8800 60%, #ff3300 100%); }
    16% { background:radial-gradient(circle at 40% 40%, #fff, #ff7700 30%, #ffff00 60%, #ff7700 100%); }
    24% { background:radial-gradient(circle at 40% 40%, #fff, #ffaa00 30%, #ffff00 60%, #ffaa00 100%); }
    32% { background:radial-gradient(circle at 40% 40%, #fff, #00ff00 30%, #00ff88 60%, #00ff00 100%); }
    40% { background:radial-gradient(circle at 40% 40%, #fff, #00ff44 30%, #00dd88 60%, #00ff44 100%); }
    48% { background:radial-gradient(circle at 40% 40%, #fff, #0088ff 30%, #0000ff 60%, #0088ff 100%); }
    56% { background:radial-gradient(circle at 40% 40%, #fff, #0055ff 30%, #0044ff 60%, #0055ff 100%); }
    64% { background:radial-gradient(circle at 40% 40%, #fff, #4400ff 30%, #9900ff 60%, #4400ff 100%); }
    72% { background:radial-gradient(circle at 40% 40%, #fff, #7700ff 30%, #9944ff 60%, #7700ff 100%); }
    80% { background:radial-gradient(circle at 40% 40%, #fff, #ff0088 30%, #ff0000 60%, #ff0088 100%); }
    88% { background:radial-gradient(circle at 40% 40%, #fff, #ff0044 30%, #ff4400 60%, #ff0044 100%); }
    100% { background:radial-gradient(circle at 40% 40%, #fff, #ff0000 30%, #ff7700 60%, #ff0000 100%); }
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–æ—Ä–≥–æ–≤—Ü–∞ */
  .trader-btn {
    padding: 12px 28px;
    font-size: 1.1rem;
    margin: 12px 8px;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    font-weight: bold;
    transition: all .2s;
    background: #4CAF50;
    color: white;
    position: relative;
    z-index: 1;
  }
  
  .trader-btn:hover {
    background: #66BB6A;
    transform: translateY(-2px);
  }
  
  .trader-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.9);
    backdrop-filter: blur(12px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }
  
  .trader-modal.active {
    display: flex;
  }
  
  .trader-modal-content {
    background: linear-gradient(135deg, #1a0033, #2d004d, #1a0033);
    border: 2px solid #4CAF50;
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 0 60px rgba(76, 175, 80, 0.5);
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .trader-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 25px 0;
  }
  
  .trader-item {
    background: rgba(80, 40, 120, .4);
    border: 2px solid #4CAF50;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all .3s;
  }
  
  .trader-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
  }
  
  .trader-item-icon {
    font-size: 3.5rem;
    margin-bottom: 15px;
  }
  
  .trader-item-name {
    font-size: 1.4rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #ffffff;
  }
  
  .trader-item-desc {
    font-size: 0.9rem;
    opacity: 0.85;
    margin-bottom: 15px;
    min-height: 40px;
  }
  
  .trader-item-price {
    font-size: 1.2rem;
    color: #FFD700;
    margin-bottom: 15px;
    font-weight: bold;
  }
  
  .trader-buy-btn {
    padding: 10px 20px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all .2s;
    width: 100%;
  }
  
  .trader-buy-btn:hover:not(:disabled) {
    background: #66BB6A;
    transform: scale(1.05);
  }
  
  .trader-buy-btn:disabled {
    background: #555;
    cursor: not-allowed;
  }
  
  .trader-timer {
    margin-top: 20px;
    padding: 15px;
    background: rgba(76, 175, 80, 0.2);
    border-radius: 10px;
    border: 1px solid #4CAF50;
  }
  
  .trader-timer-text {
    font-size: 1.1rem;
    color: #b0ffcc;
  }
  
  .trader-timer-value {
    font-size: 1.4rem;
    color: #FFD700;
    font-weight: bold;
    margin-top: 5px;
  }

  /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
  .inventory-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 12px 24px;
    font-size: 1.1rem;
    background: #FF9800;
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.5);
    z-index: 1000;
    transition: all .2s;
    font-weight: bold;
  }
  
  .inventory-btn:hover {
    background: #FFB74D;
    transform: translateY(-2px);
  }
  
  .inventory-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.9);
    backdrop-filter: blur(12px);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }
  
  .inventory-modal.active {
    display: flex;
  }
  
  .inventory-modal-content {
    background: linear-gradient(135deg, #1a0033, #2d004d, #1a0033);
    border: 2px solid #FF9800;
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 0 60px rgba(255, 152, 0, 0.5);
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .inventory-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin: 25px 0;
  }
  
  .inventory-item {
    background: rgba(80, 40, 120, .4);
    border: 2px solid #FF9800;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all .3s;
    position: relative;
  }
  
  .inventory-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
  }
  
  .inventory-item-icon {
    font-size: 3.5rem;
    margin-bottom: 15px;
  }
  
  .inventory-item-name {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #ffffff;
  }
  
  .inventory-item-desc {
    font-size: 0.85rem;
    opacity: 0.85;
    margin-bottom: 15px;
    min-height: 40px;
  }
  
  .inventory-item-quantity {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #FF9800;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
  }
  
  .inventory-use-btn {
    padding: 8px 16px;
    background: #FF9800;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all .2s;
    width: 100%;
  }
  
  .inventory-use-btn:hover:not(:disabled) {
    background: #FFB74D;
    transform: scale(1.05);
  }
  
  .inventory-use-btn:disabled {
    background: #555;
    cursor: not-allowed;
  }
  
  .inventory-empty {
    padding: 40px;
    text-align: center;
    color: #b0bec5;
    font-size: 1.2rem;
  }
  
  .inventory-empty-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
  @media (max-width: 768px) {
    .case-modal-content { padding:40px 30px; border-radius:30px; }
    .case-roulette { font-size:8rem; min-height:120px; letter-spacing:10px; }
    .case-modal-label { font-size:1.8rem; margin-bottom:20px; }
    .case-modal-result { font-size:1.3rem; margin-top:25px; }
    .inventory-btn, .promo-toggle-btn {
      padding: 10px 20px;
      font-size: 1rem;
    }
    h1 { font-size: 2.8rem; }
  }

  @media (max-width: 480px) {
    .case-modal-content { padding:30px 20px; border-radius:20px; }
    .case-roulette { font-size:6rem; min-height:100px; letter-spacing:5px; text-shadow:0 0 20px #ff8c00,0 0 40px #ff6b00; }
    .case-modal-label { font-size:1.5rem; margin-bottom:15px; }
    .case-modal-result { font-size:1.1rem; margin-top:20px; }
    h1 { font-size:2.2rem; }
    .score { font-size:3rem; }
    .multiplier { font-size:1rem; }
    .inventory-btn, .promo-toggle-btn {
      padding: 8px 16px;
      font-size: 0.9rem;
      top: 10px;
      left: 10px;
    }
    .promo-toggle-btn {
      right: 10px;
      top: 10px;
    }
    .sphere {
      filter: blur(20px);
    }
  }
</style>
</head>
<body>

<!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
<div class="animated-bg"></div>
<div class="particles" id="particles"></div>
<div class="pulsing-spheres" id="pulsingSpheres"></div>
<div class="stars" id="stars"></div>
<div class="spirals" id="spirals"></div>

<!-- –ö–Ω–æ–ø–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
<button class="inventory-btn" id="toggleInventory">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>

<div class="main-content">
  <h1>–ì–ª–∞–∑-–∫–ª–∏–∫–µ—Ä</h1>

  <div class="eye-container">
    <div class="eye" id="eye">
      <div class="pupil"></div>
      <div class="highlight"></div>
      <div class="no-energy-text" id="noEnergyMsg">–≠–Ω–µ—Ä–≥–∏—è –∏—Å—á–µ—Ä–ø–∞–Ω–∞<br>–û–∂–∏–¥–∞–π—Ç–µ 5 –º–∏–Ω</div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä—É–ª–µ—Ç–∫–∏ –∫–µ–π—Å–æ–≤ -->
  <div class="case-modal" id="caseModal">
    <div class="case-modal-content">
      <div class="case-modal-glow"></div>
      <div class="case-modal-label">üíé –¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–µ–π—Å üíé</div>
      <div class="case-roulette" id="caseRoulette">500</div>
      <div class="case-modal-result" id="caseModalResult"></div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä—É–ª–µ—Ç–∫–∏ —Å–∫–∏–Ω–æ–≤ -->
  <div class="case-modal" id="skinCaseModal">
    <div class="case-modal-content">
      <div class="case-modal-glow"></div>
      <div class="case-modal-label">üé® –ö–µ–π—Å —Å–æ —Å–∫–∏–Ω–∞–º–∏ üé®</div>
      <div style="display:flex; align-items:center; justify-content:center; gap:20px; margin:30px 0;">
        <div id="skinRouletteSkin" style="width:180px; height:180px; border-radius:50%; border:4px solid #ffd700; box-shadow:0 0 30px #ffd70080;"></div>
      </div>
      <div id="skinRouletteText" style="font-size:2.2rem; font-weight:bold; color:#76ff03; text-shadow:0 0 15px #76ff03; min-height:40px;">–ö—Ä—É—Ç–∏—Ç—Å—è...</div>
      <div class="case-modal-result" id="skinCaseModalResult"></div>
    </div>
  </div>

  <div class="score" id="score">0</div>
  <div class="multiplier" id="multiplier">√ó1</div>

  <div class="stats">
    <div class="energy-bar-container">
      <div class="energy-bar" id="energyBar"></div>
    </div>
    <div style="margin-top:12px; color:#b0ffcc; font-size:1.3rem;">
      –≠–Ω–µ—Ä–≥–∏—è: <span id="energyText">100 / 100</span>
    </div>
  </div>

  <div>
    <button class="btn btn-shop" id="toggleShop">–ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="btn btn-ach" id="toggleAch">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
    <button class="btn trader-btn" id="toggleTrader">–¢–æ—Ä–≥–æ–≤–µ—Ü</button>
    <button class="btn prestige-btn" id="togglePrestige">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</button>
    <button class="btn btn-draw" id="toggleDraw">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –≥–ª–∞–∑</button>
  </div>

  <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
  <div class="inventory-modal" id="inventoryModal">
    <div class="inventory-modal-content">
      <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
      <p style="color: #b0bec5; margin-bottom: 20px;">–¢—É—Ç —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Å–µ –∫—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</p>
      
      <div class="inventory-items" id="inventoryItems">
        <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
      </div>
      
      <button class="btn" id="closeInventory" style="margin-top: 25px; background: #d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shop">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    
    <div style="margin-bottom:30px; padding-bottom:20px; border-bottom:1px solid #7b1fa2;">
      <h3 style="margin-top:0;">–°–∫–∏–Ω—ã</h3>
      <div class="skin-grid" id="skinGrid"></div>
    </div>

    <div style="margin-bottom:30px;">
      <h3 style="margin-top:0;">–ö–µ–π—Å—ã</h3>
      <div style="background:rgba(80,40,120,.4); border:2px solid #7b1fa2; border-radius:12px; padding:20px; text-align:center; margin-bottom:20px;">
        <div style="font-size:3rem; margin-bottom:10px;">üíé</div>
        <div style="font-size:1.2rem; font-weight:bold; margin-bottom:10px;">–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–µ–π—Å</div>
        <div style="color:#b0bec5; margin-bottom:15px;">–í—ã–ø–∞–¥–∞–µ—Ç –æ—Ç 100 –¥–æ 10 000 –æ—á–∫–æ–≤!</div>
        <button class="btn btn-shop" id="openCaseBtn" style="background:#ffc107; color:#000; font-weight:bold;">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å (1500 –æ—á–∫–æ–≤)</button>
        <div id="caseResult" style="margin-top:15px; font-size:1.1rem; font-weight:bold; min-height:20px;"></div>
      </div>

      <div style="background:rgba(80,40,120,.4); border:2px solid #7b1fa2; border-radius:12px; padding:20px; text-align:center;">
        <div style="font-size:3rem; margin-bottom:10px;">üé®</div>
        <div style="font-size:1.2rem; font-weight:bold; margin-bottom:10px;">–ö–µ–π—Å —Å–æ —Å–∫–∏–Ω–∞–º–∏</div>
        <div style="color:#b0bec5; margin-bottom:15px;">–í—ã–ø–∞–¥–∞–µ—Ç —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Å–∫–∏–Ω –∏–∑ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö!</div>
        <button class="btn btn-shop" id="openSkinCaseBtn" style="background:#e91e63; color:#fff; font-weight:bold;">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å (1000 –æ—á–∫–æ–≤)</button>
        <div id="skinCaseResult" style="margin-top:15px; font-size:1.1rem; font-weight:bold; min-height:20px;"></div>
      </div>
    </div>

    <button class="btn btn-shop" id="closeShop" style="margin-top:25px; background:#d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
  <div id="achievements">
    <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
    <div class="ach-grid" id="achGrid"></div>
    <button class="btn btn-ach" id="closeAch" style="margin-top:25px; background:#ff8a33;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –¢–æ—Ä–≥–æ–≤–µ—Ü -->
  <div class="trader-modal" id="traderModal">
    <div class="trader-modal-content">
      <h2>üõí –¢–æ—Ä–≥–æ–≤–µ—Ü</h2>
      <p style="color: #b0bec5; margin-bottom: 20px;">–¢–æ–≤–∞—Ä—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</p>
      
      <div class="trader-items" id="traderItems">
        <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
      </div>
      
      <div class="trader-timer">
        <div class="trader-timer-text">–î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤:</div>
        <div class="trader-timer-value" id="traderTimer">5:00</div>
      </div>
      
      <button class="btn" id="closeTrader" style="margin-top: 25px; background: #d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è -->
  <div id="prestige">
    <h2>–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</h2>
    <p class="prestige-info">–¢–µ–∫—É—â–µ–µ: <span id="currentPrestige">0</span></p>
    <p class="prestige-info">–°–ª–µ–¥—É—é—â–∏–π: √ó<span id="nextMultiplier">2</span> –∑–∞ –∫–ª–∏–∫</p>
    <button class="prestige-btn" id="doPrestige" disabled>–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è</button>
    <p id="prestigeStatus" style="margin-top:15px; color:#ffeb3b;"></p>
    <button class="btn btn-shop" id="closePrestige" style="margin-top:25px; background:#d81b60;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—è -->
  <div class="draw-modal" id="drawModal">
    <div class="draw-modal-content">
      <h2>–ù–∞—Ä–∏—Å—É–π —Å–≤–æ–π —Å–∫–∏–Ω</h2>
      <canvas id="drawCanvas" width="300" height="300"></canvas>
      <div class="draw-controls">
        <label for="backgroundColorPicker">–¶–≤–µ—Ç –≥–ª–∞–∑–∞:</label>
        <input type="color" id="backgroundColorPicker" value="#ffffff">
        <label for="colorPicker">–¶–≤–µ—Ç –∫–∏—Å—Ç–∏:</label>
        <input type="color" id="colorPicker" value="#000000">
        <label for="brushSize">–†–∞–∑–º–µ—Ä:</label>
        <input type="range" id="brushSize" min="1" max="50" value="5">
        <button class="btn" id="clearCanvasBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button class="btn" id="saveSkinBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" id="closeDrawModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

</div>

<!-- –ü—Ä–æ–º–æ–∫–æ–¥—ã -->
<button class="promo-toggle-btn" id="togglePromo">–ü—Ä–æ–º–æ–∫–æ–¥</button>

<div class="promo-box" id="promoBox">
  <h3>–í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥</h3>
  <input type="text" id="promoInput" class="promo-input" placeholder="–í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥">
  <button class="promo-btn" id="activatePromo">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  <div id="promoResult" class="promo-result"></div>
</div>

<script>
// =============================================
// –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù
// =============================================
function createAnimatedBackground() {
  // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã
  const particlesContainer = document.getElementById('particles');
  const particleCount = 50;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    
    // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ç 2px –¥–æ 8px
    const size = Math.random() * 6 + 2;
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    
    // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
    const colors = [
      'rgba(123, 31, 162, 0.5)', // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
      'rgba(76, 175, 80, 0.5)',  // –ó–µ–ª–µ–Ω—ã–π
      'rgba(255, 152, 0, 0.5)',  // –û—Ä–∞–Ω–∂–µ–≤—ã–π
      'rgba(33, 150, 243, 0.5)', // –ì–æ–ª—É–±–æ–π
      'rgba(233, 30, 99, 0.5)',  // –†–æ–∑–æ–≤—ã–π
      'rgba(255, 215, 0, 0.5)'   // –ó–æ–ª–æ—Ç–æ–π
    ];
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    
    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
    particle.style.left = `${Math.random() * 100}%`;
    particle.style.top = `${Math.random() * 100}%`;
    
    // –°–ª—É—á–∞–π–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
    const duration = Math.random() * 20 + 10; // –æ—Ç 10 –¥–æ 30 —Å–µ–∫—É–Ω–¥
    const delay = Math.random() * 5; // –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç 0 –¥–æ 5 —Å–µ–∫—É–Ω–¥
    particle.style.animationDuration = `${duration}s`;
    particle.style.animationDelay = `${delay}s`;
    
    particlesContainer.appendChild(particle);
  }
  
  // –°–æ–∑–¥–∞–µ–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ —Å—Ñ–µ—Ä—ã
  const spheresContainer = document.getElementById('pulsingSpheres');
  const sphereCount = 5;
  
  for (let i = 0; i < sphereCount; i++) {
    const sphere = document.createElement('div');
    sphere.className = 'sphere';
    
    // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ç 100px –¥–æ 300px
    const size = Math.random() * 200 + 100;
    sphere.style.width = `${size}px`;
    sphere.style.height = `${size}px`;
    
    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
    sphere.style.left = `${Math.random() * 100}%`;
    sphere.style.top = `${Math.random() * 100}%`;
    
    // –°–ª—É—á–∞–π–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
    const duration = Math.random() * 10 + 6; // –æ—Ç 6 –¥–æ 16 —Å–µ–∫—É–Ω–¥
    const delay = Math.random() * 5;
    sphere.style.animationDuration = `${duration}s`;
    sphere.style.animationDelay = `${delay}s`;
    
    spheresContainer.appendChild(sphere);
  }
  
  // –°–æ–∑–¥–∞–µ–º –º–µ—Ä—Ü–∞—é—â–∏–µ –∑–≤–µ–∑–¥—ã
  const starsContainer = document.getElementById('stars');
  const starCount = 100;
  
  for (let i = 0; i < starCount; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    
    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
    star.style.left = `${Math.random() * 100}%`;
    star.style.top = `${Math.random() * 100}%`;
    
    // –°–ª—É—á–∞–π–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
    const duration = Math.random() * 4 + 1; // –æ—Ç 1 –¥–æ 5 —Å–µ–∫—É–Ω–¥
    const delay = Math.random() * 3;
    star.style.animationDuration = `${duration}s`;
    star.style.animationDelay = `${delay}s`;
    
    starsContainer.appendChild(star);
  }
  
  // –°–æ–∑–¥–∞–µ–º –≤—Ä–∞—â–∞—é—â–∏–µ—Å—è —Å–ø–∏—Ä–∞–ª–∏
  const spiralsContainer = document.getElementById('spirals');
  
  for (let i = 0; i < 3; i++) {
    const spiral = document.createElement('div');
    spiral.className = 'spiral';
    
    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–ø–∏—Ä–∞–ª–∏
    spiral.style.left = '50%';
    spiral.style.top = '50%';
    spiral.style.transform = 'translate(-50%, -50%)';
    
    spiralsContainer.appendChild(spiral);
  }
}

// =============================================
// –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î (–∫–ª–∏–∫–∏, –º–∞–≥–∞–∑–∏–Ω, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è, –ø—Ä–æ–º–æ–∫–æ–¥—ã)
// =============================================
const SKINS = [
  { id: "default", name: "–ö–ª–∞—Å—Å–∏–∫–∞", price: 0, bg: "radial-gradient(circle at 40% 40%, #fff 0%, #d0e8ff 30%, #80b0ff 60%, #3060ff 100%)" },
  { id: "fire", name: "–ü–ª–∞–º—è", price: 250, bg: "radial-gradient(circle at 40% 40%, #fff, #ffe082 20%, #ff9800 50%, #d50000 90%)" },
  { id: "void", name: "–ü—É—Å—Ç–æ—Ç–∞", price: 400, bg: "radial-gradient(circle at 40% 40%, #111, #1a0033 30%, #4a148c 60%, #000 100%)" },
  { id: "toxic", name: "–Ø–¥–æ–≤–∏—Ç—ã–π", price: 600, bg: "radial-gradient(circle at 40% 40%, #e0f2f1, #b2dfdb 30%, #009688 60%, #004d40 100%)" },
  { id: "neon", name: "–ù–µ–æ–Ω", price: 1200, bg: "radial-gradient(circle at 40% 40%, #fff, #e91e63 30%, #00e5ff 60%, #000 100%)" },
  { id: "gold", name: "–ó–æ–ª–æ—Ç–æ–π", price: 2500, bg: "radial-gradient(circle at 40% 40%, #fff, #fff176 30%, #ffc107 60%, #ff8f00 100%)" },
  { id: "2026", name: "–†–æ–∂–¥–µ—Å—Ç–≤–æ", price: "–ü—Ä–æ–º–æ–∫–æ–¥", bg: "radial-gradient(circle at 40% 40%, #ff004d 0%, #ff4d00 30%, #0066ff 60%, #0033aa 100%)" },
  { id: "purple", name: "–§–∏–æ–ª–µ—Ç–æ–≤—ã–π", price: 800, bg: "radial-gradient(circle at 40% 40%, #e1bee7, #ce93d8 30%, #9c27b0 60%, #4a148c 100%)" },
  { id: "cyan", name: "–ì–æ–ª—É–±–æ–π", price: 950, bg: "radial-gradient(circle at 40% 40%, #b2ebf2, #80deea 30%, #00bcd4 60%, #006064 100%)" },
  { id: "lime", name: "–õ–∞–π–º", price: 1100, bg: "radial-gradient(circle at 40% 40%, #f1f8e9, #dcedc8 30%, #cddc39 60%, #827717 100%)" },
  { id: "pink", name: "–†–æ–∑–æ–≤—ã–π", price: 1300, bg: "radial-gradient(circle at 40% 40%, #fce4ec, #f8bbd0 30%, #e91e63 60%, #880e4f 100%)" },
  { id: "orange", name: "–û—Ä–∞–Ω–∂–µ–≤—ã–π", price: 1400, bg: "radial-gradient(circle at 40% 40%, #ffe0b2, #ffcc80 30%, #ff9800 60%, #e65100 100%)" },
  { id: "teal", name: "–ë–∏—Ä—é–∑–∞", price: 1500, bg: "radial-gradient(circle at 40% 40%, #b2dfdb, #80cbc4 30%, #009688 60%, #00251a 100%)" },
  { id: "indigo", name: "–ò–Ω–¥–∏–≥–æ", price: 1800, bg: "radial-gradient(circle at 40% 40%, #c5cae9, #9fa8da 30%, #3f51b5 60%, #1a237e 100%)" },
  { id: "red", name: "–ö—Ä–∞—Å–Ω—ã–π", price: 1600, bg: "radial-gradient(circle at 40% 40%, #ffcdd2, #ef9a9a 30%, #f44336 60%, #b71c1c 100%)" },
  { id: "glass", name: "–°—Ç–µ–∫–ª—è–Ω–Ω—ã–π", price: 2000, bg: "radial-gradient(circle at 40% 40%, rgba(255,255,255,0.9), rgba(173,216,230,0.8) 30%, rgba(100,149,237,0.7) 60%, rgba(25,25,112,0.9) 100%)" },
  { id: "rainbow", name: "–†–∞–¥—É–≥–∞", price: 100000, bg: "radial-gradient(circle at 40% 40%, #fff, #ff0000 30%, #ff7700 60%, #ff0000 100%)", animated: true }
];

const ACHIEVEMENTS = [
  { id: "clicks_100", name: "–ù–æ–≤–∏—á–æ–∫", desc: "–°–¥–µ–ª–∞—Ç—å 100 –∫–ª–∏–∫–æ–≤", icon: "‚úä", target: 100 },
  { id: "clicks_1000", name: "–£–¥–∞—Ä–Ω–∏–∫", desc: "1000 –∫–ª–∏–∫–æ–≤", icon: "üí™", target: 1000 },
  { id: "clicks_5000", name: "–ë–µ–∑—É–º–Ω—ã–π –∫–ª–∏–∫–µ—Ä", desc: "5000 –∫–ª–∏–∫–æ–≤", icon: "üî•", target: 5000 },
  { id: "clicks_20000", name: "–õ–µ–≥–µ–Ω–¥–∞ –≥–ª–∞–∑–∞", desc: "20 000 –∫–ª–∏–∫–æ–≤", icon: "üåü", target: 20000 },
  { id: "skins_3", name: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä", desc: "–ö—É–ø–∏—Ç—å 3 —Å–∫–∏–Ω–∞", icon: "üõçÔ∏è", target: 3, type: "skins" },
  { id: "energy_full", name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫", desc: "–ù–∞–∫–æ–ø–∏—Ç—å 100 —ç–Ω–µ—Ä–≥–∏–∏", icon: "‚ö°", target: 100, type: "energy" }
];

const PROMOCODES = {
  "defynet": { description: "–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è!", effect: () => energy = Infinity },
  "test2025": { description: "+500 –æ—á–∫–æ–≤!", effect: () => score += 500 },
  "skinfire": { description: "–°–∫–∏–Ω ¬´–ü–ª–∞–º—è¬ª –±–µ—Å–ø–ª–∞—Ç–Ω–æ!", effect: () => { if (!ownedSkins.includes("fire")) { ownedSkins.push("fire"); currentSkin = "fire"; applySkin(); renderShop(); } } },
  "def2025": { description: "1 000 000 –æ—á–∫–æ–≤!", effect: () => score += 1000000 },
  "2026": { description: "–°–∫–∏–Ω ¬´–†–æ–∂–¥–µ—Å—Ç–≤–æ¬ª –ø–æ–ª—É—á–µ–Ω!", effect: () => { if (!ownedSkins.includes("2026")) { ownedSkins.push("2026"); currentSkin = "2026"; applySkin(); renderShop(); } } },
  "gift": { description: "+10 000 –æ—á–∫–æ–≤!", effect: () => score += 10000 },
  "67": { description: "+10 000 000 –æ—á–∫–æ–≤!", effect: () => score += 10000000 } // –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π
};

const PRESTIGE_COSTS = [500, 1500, 2500, 4000, 5500, 7000, 8500, 10000, 12000, 14000];
const PRESTIGE_LEVELS = 10;

const STORAGE = {
  score: 'eyeClickerScore',
  energy: 'eyeClickerEnergy',
  lastTime: 'eyeClickerLastTime',
  owned: 'eyeClickerOwnedSkins',
  current: 'eyeClickerCurrentSkin',
  progress: 'eyeClickerAchProgress',
  completed: 'eyeClickerAchCompleted',
  usedPromos: 'eyeClickerUsedPromos',
  prestige: 'eyeClickerPrestige',
  clickMultiplier: 'eyeClickerMultiplier',
  totalClicks: 'eyeClickerTotalClicks',
  inventory: 'eyeClickerInventory'
};

let score = Number(localStorage.getItem(STORAGE.score)) || 0;
let energy = Number(localStorage.getItem(STORAGE.energy)) || 100;
let lastTime = Number(localStorage.getItem(STORAGE.lastTime)) || Date.now();
let ownedSkins = JSON.parse(localStorage.getItem(STORAGE.owned)) || ["default"];
let currentSkin = localStorage.getItem(STORAGE.current) || "default";
let achProgress = JSON.parse(localStorage.getItem(STORAGE.progress)) || {};
let completed = new Set(JSON.parse(localStorage.getItem(STORAGE.completed)) || []);
let usedPromos = new Set(JSON.parse(localStorage.getItem(STORAGE.usedPromos)) || []);
let prestigeLevel = Number(localStorage.getItem(STORAGE.prestige)) || 0;
let clickMultiplier = Number(localStorage.getItem(STORAGE.clickMultiplier)) || 1;
let totalClicks = Number(localStorage.getItem(STORAGE.totalClicks)) || 0;
let inventory = JSON.parse(localStorage.getItem(STORAGE.inventory)) || {};

function getMaxEnergy() {
  return 100 + (prestigeLevel * 50);
}

const MAX_ENERGY = getMaxEnergy();

energy = Math.min(MAX_ENERGY, energy + Math.floor((Date.now() - lastTime) / 1000 / 300));

// =============================================
// –¢–û–†–ì–û–í–ï–¶
// =============================================
const TRADER_ITEMS_POOL = [
  {
    id: "energy_boost",
    name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫",
    description: "+50 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ 1 —á–∞—Å",
    icon: "‚ö°",
    price: 800,
    effect: function() {
      const oldMax = getMaxEnergy();
      const newMax = oldMax + 50;
      energy = Math.min(energy + 50, newMax);
      // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ 1 —á–∞—Å
      setTimeout(() => {
        energy = Math.min(energy, oldMax);
        updateUI();
      }, 3600000);
    }
  },
  {
    id: "click_power",
    name: "–£—Å–∏–ª–∏—Ç–µ–ª—å –∫–ª–∏–∫–∞",
    description: "√ó2 –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—é –Ω–∞ 30 –º–∏–Ω—É—Ç",
    icon: "üí•",
    price: 1200,
    effect: function() {
      const oldMultiplier = clickMultiplier;
      clickMultiplier *= 2;
      multiplierEl.textContent = `√ó${clickMultiplier}`;
      // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ 30 –º–∏–Ω—É—Ç
      setTimeout(() => {
        clickMultiplier = oldMultiplier;
        multiplierEl.textContent = `√ó${clickMultiplier}`;
      }, 1800000);
    }
  },
  {
    id: "time_skip",
    name: "–ü—Ä–æ–ø—É—Å–∫ –≤—Ä–µ–º–µ–Ω–∏",
    description: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é –º–≥–Ω–æ–≤–µ–Ω–Ω–æ",
    icon: "‚è©",
    price: 1500,
    effect: function() {
      energy = getMaxEnergy();
      updateUI();
    }
  },
  {
    id: "score_boost",
    name: "–£–¥–≤–æ–∏—Ç–µ–ª—å –æ—á–∫–æ–≤",
    description: "–°–ª–µ–¥—É—é—â–∏–µ 100 –∫–ª–∏–∫–æ–≤ –¥–∞—é—Ç √ó2 –æ—á–∫–æ–≤",
    icon: "üí∞",
    price: 2000,
    effect: function() {
      let clicksLeft = 100;
      const originalClick = eye.onclick;
      
      eye.onclick = () => {
        if (clicksLeft > 0 && energy > 0) {
          score += clickMultiplier * 2; // –í–¥–≤–æ–µ –±–æ–ª—å—à–µ
          clicksLeft--;
        } else {
          score += clickMultiplier;
        }
        energy--;
        totalClicks++;
        checkAchievements();
        updateUI();
        saveProgress();
        if (navigator.vibrate) navigator.vibrate(12);
        
        if (clicksLeft === 0) {
          eye.onclick = originalClick;
        }
      };
    }
  },
  {
    id: "prestige_token",
    name: "–¢–æ–∫–µ–Ω –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è",
    description: "+1 —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –æ—á–∫–æ–≤",
    icon: "‚≠ê",
    price: 5000,
    effect: function() {
      prestigeLevel++;
      clickMultiplier++;
      localStorage.setItem(STORAGE.prestige, prestigeLevel);
      localStorage.setItem(STORAGE.clickMultiplier, clickMultiplier);
      updatePrestigeUI();
      alert(`üéâ –¢–æ–∫–µ–Ω –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω! –¢–µ–ø–µ—Ä—å —É—Ä–æ–≤–µ–Ω—å ${prestigeLevel} –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—å √ó${clickMultiplier}`);
    }
  },
  {
    id: "skin_discount",
    name: "–°–∫–∏–¥–∫–∞ –Ω–∞ —Å–∫–∏–Ω—ã",
    description: "50% —Å–∫–∏–¥–∫–∞ –Ω–∞ –≤—Å–µ —Å–∫–∏–Ω—ã –Ω–∞ 10 –º–∏–Ω—É—Ç",
    icon: "üé®",
    price: 3000,
    effect: function() {
      SKINS.forEach(skin => {
        if (skin.price !== "–ü—Ä–æ–º–æ–∫–æ–¥" && skin.price > 0) {
          skin.originalPrice = skin.price;
          skin.price = Math.floor(skin.price / 2);
        }
      });
      renderShop();
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
      setTimeout(() => {
        SKINS.forEach(skin => {
          if (skin.originalPrice) {
            skin.price = skin.originalPrice;
            delete skin.originalPrice;
          }
        });
        renderShop();
      }, 600000);
    }
  },
  {
    id: "case_bundle",
    name: "–ù–∞–±–æ—Ä –∫–µ–π—Å–æ–≤",
    description: "3 —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–µ–π—Å–∞ + 2 –∫–µ–π—Å–∞ —Å–æ —Å–∫–∏–Ω–∞–º–∏",
    icon: "üéÅ",
    price: 8000,
    effect: function() {
      // 3 –æ–±—ã—á–Ω—ã—Ö –∫–µ–π—Å–∞
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          const reward = generateCaseReward();
          score += reward;
          alert(`üéâ –¢—ã –ø–æ–ª—É—á–∏–ª ${reward} –æ—á–∫–æ–≤ –∏–∑ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–µ–π—Å–∞!`);
          updateUI();
          saveProgress();
        }, i * 1000);
      }
      
      // 2 –∫–µ–π—Å–∞ —Å–æ —Å–∫–∏–Ω–∞–º–∏
      for (let i = 0; i < 2; i++) {
        setTimeout(() => {
          const skin = generateSkinCaseReward();
          if (!ownedSkins.includes(skin.id)) {
            ownedSkins.push(skin.id);
            alert(`üé® –¢—ã –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—ã–π —Å–∫–∏–Ω: ${skin.name}!`);
          } else {
            alert(`üé® –¢—ã –ø–æ–ª—É—á–∏–ª —Å–∫–∏–Ω: ${skin.name} (—É–∂–µ –±—ã–ª –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏)`);
          }
          renderShop();
          saveProgress();
        }, (i + 3) * 1000);
      }
    }
  },
  {
    id: "rainbow_charm",
    name: "–†–∞–¥—É–∂–Ω—ã–π –∞–º—É–ª–µ—Ç",
    description: "5% —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å √ó10 –æ—á–∫–æ–≤ –∑–∞ –∫–ª–∏–∫",
    icon: "üåà",
    price: 10000,
    effect: function() {
      const originalClick = eye.onclick;
      
      eye.onclick = () => {
        if (energy > 0) {
          let multiplier = clickMultiplier;
          if (Math.random() < 0.05) { // 5% —à–∞–Ω—Å
            multiplier *= 10;
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            eye.style.boxShadow = "0 0 80px rgba(255,0,255,.9), inset 0 0 80px rgba(0,0,0,.4)";
            setTimeout(() => {
              eye.style.boxShadow = "0 0 60px rgba(48,96,255,.7), inset 0 0 80px rgba(0,0,0,.4)";
            }, 300);
          }
          
          score += multiplier;
          energy--;
          totalClicks++;
          checkAchievements();
          updateUI();
          saveProgress();
          if (navigator.vibrate) navigator.vibrate(12);
        }
      };
      
      // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª–∏—Ç—Å—è 15 –º–∏–Ω—É—Ç
      setTimeout(() => {
        eye.onclick = originalClick;
        eye.style.boxShadow = "0 0 60px rgba(48,96,255,.7), inset 0 0 80px rgba(0,0,0,.4)";
      }, 900000);
    }
  }
];

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—Ä–≥–æ–≤—Ü–∞
let currentTraderItems = [];
let traderUpdateTime = localStorage.getItem('eyeClickerTraderUpdate') || Date.now();
let traderTimerInterval = null;

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–æ—Ä–≥–æ–≤—Ü–∞
const toggleTraderBtn = document.getElementById('toggleTrader');
const traderModal = document.getElementById('traderModal');
const closeTraderBtn = document.getElementById('closeTrader');
const traderItemsContainer = document.getElementById('traderItems');
const traderTimerEl = document.getElementById('traderTimer');

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
const toggleInventoryBtn = document.getElementById('toggleInventory');
const inventoryModal = document.getElementById('inventoryModal');
const closeInventoryBtn = document.getElementById('closeInventory');
const inventoryItemsContainer = document.getElementById('inventoryItems');

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
function addToInventory(itemId, quantity = 1) {
  if (!inventory[itemId]) {
    inventory[itemId] = quantity;
  } else {
    inventory[itemId] += quantity;
  }
  saveInventory();
  renderInventory();
}

// –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
function useFromInventory(itemId) {
  if (!inventory[itemId] || inventory[itemId] <= 0) return false;
  
  const item = TRADER_ITEMS_POOL.find(i => i.id === itemId);
  if (!item) return false;
  
  // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
  item.effect();
  
  // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  inventory[itemId]--;
  if (inventory[itemId] <= 0) {
    delete inventory[itemId];
  }
  
  saveInventory();
  renderInventory();
  return true;
}

// –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
function saveInventory() {
  localStorage.setItem(STORAGE.inventory, JSON.stringify(inventory));
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
function renderInventory() {
  inventoryItemsContainer.innerHTML = '';
  
  const itemIds = Object.keys(inventory);
  
  if (itemIds.length === 0) {
    const emptyDiv = document.createElement('div');
    emptyDiv.className = 'inventory-empty';
    emptyDiv.innerHTML = `
      <div class="inventory-empty-icon">üéí</div>
      <p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
      <p style="font-size: 0.9rem; margin-top: 10px;">–ö—É–ø–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã —É —Ç–æ—Ä–≥–æ–≤—Ü–∞, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–¥–µ—Å—å</p>
    `;
    inventoryItemsContainer.appendChild(emptyDiv);
    return;
  }
  
  itemIds.forEach(itemId => {
    const item = TRADER_ITEMS_POOL.find(i => i.id === itemId);
    if (!item) return;
    
    const quantity = inventory[itemId];
    
    const itemEl = document.createElement('div');
    itemEl.className = 'inventory-item';
    
    const icon = document.createElement('div');
    icon.className = 'inventory-item-icon';
    icon.textContent = item.icon;
    
    const name = document.createElement('div');
    name.className = 'inventory-item-name';
    name.textContent = item.name;
    
    const desc = document.createElement('div');
    desc.className = 'inventory-item-desc';
    desc.textContent = item.description;
    
    const quantityBadge = document.createElement('div');
    quantityBadge.className = 'inventory-item-quantity';
    quantityBadge.textContent = quantity;
    
    const useBtn = document.createElement('button');
    useBtn.className = 'inventory-use-btn';
    useBtn.textContent = '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å';
    
    useBtn.onclick = () => {
      if (useFromInventory(itemId)) {
        alert(`‚úÖ ${item.name} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!`);
      }
    };
    
    itemEl.append(icon, name, desc, quantityBadge, useBtn);
    inventoryItemsContainer.appendChild(itemEl);
  });
}

// –°–æ–±—ã—Ç–∏—è –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
toggleInventoryBtn.onclick = () => {
  inventoryModal.classList.add('active');
  renderInventory();
};

closeInventoryBtn.onclick = () => {
  inventoryModal.classList.remove('active');
};

// –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
function generateTraderItems() {
  // –í—ã–±–∏—Ä–∞–µ–º 4 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞ –∏–∑ –ø—É–ª–∞
  const shuffled = [...TRADER_ITEMS_POOL].sort(() => 0.5 - Math.random());
  currentTraderItems = shuffled.slice(0, 4);
  traderUpdateTime = Date.now();
  localStorage.setItem('eyeClickerTraderUpdate', traderUpdateTime);
  localStorage.setItem('eyeClickerTraderItems', JSON.stringify(currentTraderItems));
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
function loadTraderItems() {
  const savedItems = localStorage.getItem('eyeClickerTraderItems');
  const savedTime = localStorage.getItem('eyeClickerTraderUpdate');
  
  if (savedItems && savedTime) {
    const timePassed = Date.now() - savedTime;
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300000 –º—Å)
    if (timePassed < 300000) {
      currentTraderItems = JSON.parse(savedItems);
      traderUpdateTime = Number(savedTime);
    } else {
      generateTraderItems();
    }
  } else {
    generateTraderItems();
  }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Ç–æ—Ä–≥–æ–≤—Ü–∞
function renderTraderItems() {
  traderItemsContainer.innerHTML = '';
  
  currentTraderItems.forEach(item => {
    const itemEl = document.createElement('div');
    itemEl.className = 'trader-item';
    
    const icon = document.createElement('div');
    icon.className = 'trader-item-icon';
    icon.textContent = item.icon;
    
    const name = document.createElement('div');
    name.className = 'trader-item-name';
    name.textContent = item.name;
    
    const desc = document.createElement('div');
    desc.className = 'trader-item-desc';
    desc.textContent = item.description;
    
    const price = document.createElement('div');
    price.className = 'trader-item-price';
    price.textContent = `${item.price.toLocaleString()} –æ—á–∫–æ–≤`;
    
    const buyBtn = document.createElement('button');
    buyBtn.className = 'trader-buy-btn';
    buyBtn.textContent = '–ö—É–ø–∏—Ç—å';
    buyBtn.disabled = score < item.price;
    
    buyBtn.onclick = () => {
      if (score >= item.price) {
        score -= item.price;
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        addToInventory(item.id, 1);
        updateUI();
        saveProgress();
        renderTraderItems(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        alert(`‚úÖ ${item.name} –∫—É–ø–ª–µ–Ω! –¢–µ–ø–µ—Ä—å –æ–Ω –≤ –≤–∞—à–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ.`);
      }
    };
    
    itemEl.append(icon, name, desc, price, buyBtn);
    traderItemsContainer.appendChild(itemEl);
  });
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤—Ü–∞
function updateTraderTimer() {
  const timeLeft = 300000 - (Date.now() - traderUpdateTime);
  
  if (timeLeft <= 0) {
    generateTraderItems();
    renderTraderItems();
    updateTraderTimer();
    return;
  }
  
  const minutes = Math.floor(timeLeft / 60000);
  const seconds = Math.floor((timeLeft % 60000) / 1000);
  traderTimerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// –°–æ–±—ã—Ç–∏—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤—Ü–∞
toggleTraderBtn.onclick = () => {
  traderModal.classList.add('active');
  renderTraderItems();
  updateTraderTimer();
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
  if (traderTimerInterval) clearInterval(traderTimerInterval);
  traderTimerInterval = setInterval(updateTraderTimer, 1000);
};

closeTraderBtn.onclick = () => {
  traderModal.classList.remove('active');
  if (traderTimerInterval) {
    clearInterval(traderTimerInterval);
    traderTimerInterval = null;
  }
};

// =============================================
// –ö–ï–ô–°–´
// =============================================
const CASE_PRICE = 1500;
const CASE_MIN_REWARD = 100;
const CASE_MAX_REWARD = 10000;
const SKIN_CASE_PRICE = 1000;

function generateCaseReward() {
  return Math.floor(Math.random() * (CASE_MAX_REWARD - CASE_MIN_REWARD + 1)) + CASE_MIN_REWARD;
}

function generateSkinCaseReward() {
  // 1% —à–∞–Ω—Å –Ω–∞ —Ä–∞–¥—É–∂–Ω—ã–π —Å–∫–∏–Ω
  if (Math.random() < 0.01) {
    return SKINS.find(s => s.id === 'rainbow');
  }
  // 99% –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫–∏–Ω—ã (–∫—Ä–æ–º–µ —Ä–∞–¥—É–∂–Ω–æ–≥–æ)
  const nonRainbowSkins = SKINS.filter(s => s.id !== 'rainbow');
  return nonRainbowSkins[Math.floor(Math.random() * nonRainbowSkins.length)];
}

// DOM
const eye = document.getElementById('eye');
const scoreEl = document.getElementById('score');
const multiplierEl = document.getElementById('multiplier');
const energyBar = document.getElementById('energyBar');
const energyText = document.getElementById('energyText');
const noEnergyMsg = document.getElementById('noEnergyMsg');
const promoInput = document.getElementById('promoInput');
const activateBtn = document.getElementById('activatePromo');
const promoResult = document.getElementById('promoResult');
const promoBox = document.getElementById('promoBox');
const togglePromo = document.getElementById('togglePromo');
const shop = document.getElementById('shop');
const achPanel = document.getElementById('achievements');
const prestigePanel = document.getElementById('prestige');
const skinGrid = document.getElementById('skinGrid');
const achGrid = document.getElementById('achGrid');
const btnShop = document.getElementById('toggleShop');
const btnCloseShop = document.getElementById('closeShop');
const openCaseBtn = document.getElementById('openCaseBtn');
const caseResult = document.getElementById('caseResult');
const openSkinCaseBtn = document.getElementById('openSkinCaseBtn');
const skinCaseResult = document.getElementById('skinCaseResult');
const btnAch = document.getElementById('toggleAch');
const btnCloseAch = document.getElementById('closeAch');
const btnPrestige = document.getElementById('togglePrestige');
const btnClosePrestige = document.getElementById('closePrestige');
const doPrestigeBtn = document.getElementById('doPrestige');
const prestigeStatus = document.getElementById('prestigeStatus');
const currentPrestigeEl = document.getElementById('currentPrestige');
const nextMultiplierEl = document.getElementById('nextMultiplier');

// Drawing modal elements
const drawModal = document.getElementById('drawModal');
const toggleDrawBtn = document.getElementById('toggleDraw');
const closeDrawModalBtn = document.getElementById('closeDrawModalBtn');
const saveSkinBtn = document.getElementById('saveSkinBtn');
const clearCanvasBtn = document.getElementById('clearCanvasBtn');
const drawCanvas = document.getElementById('drawCanvas');
const colorPicker = document.getElementById('colorPicker');
const backgroundColorPicker = document.getElementById('backgroundColorPicker');
const brushSize = document.getElementById('brushSize');
const ctx = drawCanvas.getContext('2d');
let isDrawing = false;

// =============================================
// –†–ò–°–û–í–ê–ù–ò–ï –°–ö–ò–ù–ê
// =============================================
function clearCanvas() {
  ctx.fillStyle = backgroundColorPicker.value;
  ctx.fillRect(0, 0, drawCanvas.width, drawCanvas.height);
}

function startDrawing(e) {
  e.preventDefault();
  isDrawing = true;
  draw(e);
}

function stopDrawing() {
  isDrawing = false;
  ctx.beginPath();
}

function draw(e) {
  if (!isDrawing) return;
  e.preventDefault();
  const rect = drawCanvas.getBoundingClientRect();
  
  let clientX, clientY;
  if (e.touches) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }

  const x = clientX - rect.left;
  const y = clientY - rect.top;

  ctx.lineWidth = brushSize.value;
  ctx.lineCap = 'round';
  ctx.strokeStyle = colorPicker.value;

  ctx.lineTo(x, y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, y);
}

drawCanvas.addEventListener('mousedown', startDrawing);
drawCanvas.addEventListener('mouseup', stopDrawing);
drawCanvas.addEventListener('mousemove', draw);
drawCanvas.addEventListener('mouseout', stopDrawing);

drawCanvas.addEventListener('touchstart', startDrawing, { passive: false });
drawCanvas.addEventListener('touchend', stopDrawing);
drawCanvas.addEventListener('touchmove', draw, { passive: false });

toggleDrawBtn.onclick = () => {
  drawModal.classList.add('active');
  clearCanvas();
};

backgroundColorPicker.onchange = clearCanvas;
clearCanvasBtn.onclick = clearCanvas;

closeDrawModalBtn.onclick = () => {
  drawModal.classList.remove('active');
};

saveSkinBtn.onclick = () => {
  const dataUrl = drawCanvas.toDataURL('image/png');
  const customSkin = {
    id: "custom",
    name: "–°–≤–æ–π —Å–∫–∏–Ω",
    price: 0,
    bg: `url(${dataUrl})`,
    custom: true
  };

  const existingSkinIndex = SKINS.findIndex(s => s.id === 'custom');
  if (existingSkinIndex > -1) {
    SKINS[existingSkinIndex] = customSkin;
  } else {
    SKINS.push(customSkin);
  }

  if (!ownedSkins.includes('custom')) {
    ownedSkins.push('custom');
  }
  currentSkin = 'custom';
  
  applySkin();
  renderShop();
  saveProgress();
  
  drawModal.classList.remove('active');
};

// =============================================
// –ü–ï–†–ï–†–ï–ñ–î–ï–ù–ò–Ø
// =============================================
function updatePrestigeUI() {
  currentPrestigeEl.textContent = prestigeLevel;
  multiplierEl.textContent = `√ó${clickMultiplier}`;

  if (prestigeLevel >= PRESTIGE_LEVELS) {
    doPrestigeBtn.disabled = true;
    prestigeStatus.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!';
    return;
  }

  const required = PRESTIGE_COSTS[prestigeLevel];
  const nextLevel = prestigeLevel + 1;
  nextMultiplierEl.textContent = nextLevel + 1;

  const enoughAchievements = [...completed].length >= 2;
  doPrestigeBtn.disabled = score < required || !enoughAchievements;

  prestigeStatus.textContent = doPrestigeBtn.disabled
    ? `–ù—É–∂–Ω–æ ${required.toLocaleString()} –æ—á–∫–æ–≤ + 2 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è`
    : '–ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è';
}

doPrestigeBtn.onclick = () => {
  if (doPrestigeBtn.disabled) return;

  prestigeLevel++;
  clickMultiplier++;
  score = 0;
  energy = getMaxEnergy();
  localStorage.setItem(STORAGE.prestige, prestigeLevel);
  localStorage.setItem(STORAGE.clickMultiplier, clickMultiplier);

  updateUI();
  updatePrestigeUI();
  prestigeStatus.textContent = `–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ ${prestigeLevel} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –¢–µ–ø–µ—Ä—å √ó${clickMultiplier} –∑–∞ –∫–ª–∏–∫`;
  setTimeout(() => prestigeStatus.textContent = '', 5000);
};

// =============================================
// –ü–†–û–ú–û–ö–û–î–´
// =============================================
togglePromo.onclick = () => {
  promoBox.style.display = promoBox.style.display === 'block' ? 'none' : 'block';
};

activateBtn.onclick = () => {
  const code = promoInput.value.trim().toLowerCase();
  if (!code) return;

  if (code === "67") {
    score += 10000000;
    saveProgress();
    updateUI();
    promoResult.className = 'promo-result success';
    promoResult.textContent = '+10 000 000 –æ—á–∫–æ–≤! –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ';
  } else if (usedPromos.has(code)) {
    promoResult.className = 'promo-result error';
    promoResult.textContent = '–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!';
  } else if (PROMOCODES[code]) {
    PROMOCODES[code].effect();
    usedPromos.add(code);
    saveProgress();
    updateUI();
    promoResult.className = 'promo-result success';
    promoResult.textContent = PROMOCODES[code].description;
  } else {
    promoResult.className = 'promo-result error';
    promoResult.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥';
  }

  promoInput.value = '';
  setTimeout(() => promoResult.textContent = '', 5000);
};

// =============================================
// –§–£–ù–ö–¶–ò–ò
// =============================================
function saveProgress() {
  localStorage.setItem(STORAGE.score, score);
  localStorage.setItem(STORAGE.energy, energy);
  localStorage.setItem(STORAGE.lastTime, Date.now());
  localStorage.setItem(STORAGE.owned, JSON.stringify(ownedSkins));
  localStorage.setItem(STORAGE.current, currentSkin);
  localStorage.setItem(STORAGE.progress, JSON.stringify(achProgress));
  localStorage.setItem(STORAGE.completed, JSON.stringify([...completed]));
  localStorage.setItem(STORAGE.usedPromos, JSON.stringify([...usedPromos]));
  localStorage.setItem(STORAGE.prestige, prestigeLevel);
  localStorage.setItem(STORAGE.clickMultiplier, clickMultiplier);
  localStorage.setItem(STORAGE.totalClicks, totalClicks);
  saveInventory();
}

function applySkin() {
  const skin = SKINS.find(s => s.id === currentSkin) || SKINS[0];
  eye.style.background = skin.bg;
  if (skin.custom) {
    eye.style.backgroundSize = 'cover';
    eye.style.backgroundPosition = 'center';
  } else {
    eye.style.backgroundSize = 'auto';
  }
  eye.classList.toggle('rainbow-eye', skin.animated === true);
}

// =============================================
// –î–û–°–¢–ò–ñ–ï–ù–ò–Ø
// =============================================
function checkAchievements() {
  ACHIEVEMENTS.forEach(ach => {
    if (completed.has(ach.id)) return; // —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

    let current = 0;
    
    if (ach.type === 'skins') {
      current = ownedSkins.length - 1; // –∏—Å–∫–ª—é—á–∞–µ–º "default"
    } else if (ach.type === 'energy') {
      current = Math.floor(energy);
    } else {
      current = totalClicks;
    }
    
    achProgress[ach.id] = current;
    
    if (current >= ach.target) {
      completed.add(ach.id);
      achProgress[ach.id] = ach.target;
    }
  });
}

// =============================================
// –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ï–ô–°–û–í
// =============================================
const caseModal = document.getElementById('caseModal');
const caseRoulette = document.getElementById('caseRoulette');
const caseModalResult = document.getElementById('caseModalResult');

openCaseBtn.onclick = () => {
  if (score < CASE_PRICE) {
    caseResult.textContent = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!';
    caseResult.style.color = '#ff5252';
    setTimeout(() => caseResult.textContent = '', 3000);
    return;
  }

  if (openCaseBtn.disabled) return;
  openCaseBtn.disabled = true;

  // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–µ–π—Å–∞
  score -= CASE_PRICE;
  updateUI();
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞–≥—Ä–∞–¥—É
  const reward = generateCaseReward();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä—É–ª–µ—Ç–∫–∏
  caseModal.classList.add('active');
  caseRoulette.textContent = '500';
  caseModalResult.textContent = '';
  caseRoulette.classList.add('roulette-rolling');
  
  // –ö—Ä—É—Ç–∏–º —Ä—É–ª–µ—Ç–∫—É 3 —Å–µ–∫—É–Ω–¥—ã (–º–µ–¥–ª–µ–Ω–Ω–æ)
  let counter = 0;
  const rouletteInterval = setInterval(() => {
    caseRoulette.textContent = Math.floor(Math.random() * 10000) + 100;
    counter++;
    if (counter > 30) {
      clearInterval(rouletteInterval);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      caseRoulette.classList.remove('roulette-rolling');
      caseRoulette.textContent = reward;
      
      score += reward;
      updateUI();
      saveProgress();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      setTimeout(() => {
        caseModalResult.textContent = `üéâ –¢—ã –≤—ã–∏–≥—Ä–∞–ª ${reward} –æ—á–∫–æ–≤!`;
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        setTimeout(() => {
          caseModal.classList.remove('active');
          openCaseBtn.disabled = false;
        }, 3000);
      }, 800);
    }
  }, 150);
};

// –ö–µ–π—Å —Å–æ —Å–∫–∏–Ω–∞–º–∏
openSkinCaseBtn.onclick = () => {
  if (score < SKIN_CASE_PRICE) {
    skinCaseResult.textContent = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!';
    skinCaseResult.style.color = '#ff5252';
    setTimeout(() => skinCaseResult.textContent = '', 3000);
    return;
  }

  if (openSkinCaseBtn.disabled) return;
  openSkinCaseBtn.disabled = true;

  // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
  score -= SKIN_CASE_PRICE;
  updateUI();

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω
  const finalSkin = generateSkinCaseReward();
  
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  const skinCaseModal = document.getElementById('skinCaseModal');
  const skinRouletteSkin = document.getElementById('skinRouletteSkin');
  const skinRouletteText = document.getElementById('skinRouletteText');
  const skinCaseModalResult = document.getElementById('skinCaseModalResult');
  
  skinCaseModal.classList.add('active');
  skinRouletteText.textContent = '–ö—Ä—É—Ç–∏—Ç—Å—è...';
  skinCaseModalResult.textContent = '';
  
  // –ö—Ä—É—Ç–∏–º —Ä—É–ª–µ—Ç–∫—É - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∫–∏–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥
  let counter = 0;
  const rouletteInterval = setInterval(() => {
    const randomSkin = SKINS[Math.floor(Math.random() * SKINS.length)];
    skinRouletteSkin.style.background = randomSkin.bg;
    skinRouletteText.textContent = randomSkin.name;
    counter++;
    
    if (counter > 40) {
      clearInterval(rouletteInterval);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω
      skinRouletteSkin.style.background = finalSkin.bg;
      skinRouletteText.textContent = finalSkin.name;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–∫–∏–Ω —É–∂–µ
      if (!ownedSkins.includes(finalSkin.id)) {
        // –ù–æ–≤—ã–π —Å–∫–∏–Ω!
        ownedSkins.push(finalSkin.id);
        currentSkin = finalSkin.id;
        applySkin();
        renderShop();
        skinCaseModalResult.textContent = `üéâ –ù–æ–≤—ã–π —Å–∫–∏–Ω: ${finalSkin.name}!`;
        skinCaseModalResult.style.color = '#76ff03';
      } else {
        // –°–∫–∏–Ω —É–∂–µ –µ—Å—Ç—å
        skinCaseModalResult.textContent = `üòÖ –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å: ${finalSkin.name}`;
        skinCaseModalResult.style.color = '#ffeb3b';
      }
      
      saveProgress();
      
      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      setTimeout(() => {
        skinCaseModal.classList.remove('active');
        openSkinCaseBtn.disabled = false;
      }, 3000);
    }
  }, 120);
};

function updateUI() {
  scoreEl.textContent = score.toLocaleString();
  const maxEnergy = getMaxEnergy();
  const percent = (energy / maxEnergy) * 100;
  energyBar.style.width = percent + '%';
  energyText.textContent = `${Math.floor(energy)} / ${maxEnergy}`;

  eye.classList.toggle('low-energy', energy <= 0);
  noEnergyMsg.style.opacity = energy <= 0 ? '1' : '0';

  applySkin();
}

function renderShop() {
  skinGrid.innerHTML = '';
  SKINS.forEach(skin => {
    const item = document.createElement('div');
    item.className = 'skin-item';
    if (ownedSkins.includes(skin.id)) item.classList.add('owned');
    if (currentSkin === skin.id) item.classList.add('current');

    const preview = document.createElement('div');
    preview.className = 'preview';
    preview.style.background = skin.bg;
    if (skin.custom) {
      preview.style.backgroundSize = 'cover';
      preview.style.backgroundPosition = 'center';
    }

    const name = document.createElement('div');
    name.textContent = skin.name;

    const price = document.createElement('div');
    price.textContent = skin.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : (skin.price === "–ü—Ä–æ–º–æ–∫–æ–¥" ? "–ü—Ä–æ–º–æ–∫–æ–¥" : `${skin.price} –æ—á–∫–æ–≤`);

    const btn = document.createElement('button');
    btn.className = 'buy-btn';

    if (ownedSkins.includes(skin.id)) {
      btn.textContent = currentSkin === skin.id ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å';
      btn.disabled = currentSkin === skin.id;
      btn.onclick = () => {
        currentSkin = skin.id;
        updateUI();
        renderShop();
        saveProgress();
      };
    } else if (skin.price !== "–ü—Ä–æ–º–æ–∫–æ–¥") {
      btn.textContent = `–ö—É–ø–∏—Ç—å (${skin.price})`;
      btn.disabled = score < skin.price;
      btn.onclick = () => {
        if (score >= skin.price) {
          score -= skin.price;
          ownedSkins.push(skin.id);
          currentSkin = skin.id;
          checkAchievements();
          updateUI();
          renderShop();
          saveProgress();
        }
      };
    } else {
      btn.textContent = '–ü—Ä–æ–º–æ–∫–æ–¥';
      btn.disabled = true;
    }

    item.append(preview, name, price, btn);
    skinGrid.appendChild(item);
  });
}

function renderAchievements() {
  achGrid.innerHTML = '';
  ACHIEVEMENTS.forEach(ach => {
    const item = document.createElement('div');
    item.className = 'ach-item';
    if (completed.has(ach.id)) item.classList.add('completed');

    const icon = document.createElement('div');
    icon.className = 'icon';
    icon.textContent = ach.icon;

    const name = document.createElement('div');
    name.textContent = ach.name;
    name.style.fontWeight = 'bold';

    const desc = document.createElement('div');
    desc.textContent = ach.desc;
    desc.style.fontSize = '0.9rem';
    desc.style.opacity = '0.85';

    const progress = document.createElement('div');
    progress.style.marginTop = '10px';
    progress.style.fontSize = '0.95rem';

    if (completed.has(ach.id)) {
      progress.textContent = '‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
      progress.style.color = '#ffd54f';
    } else {
      let val = achProgress[ach.id] || 0;
      progress.textContent = `${val.toLocaleString()} / ${ach.target.toLocaleString()}`;
      progress.style.color = '#b0bec5';
    }

    item.append(icon, name, desc, progress);
    achGrid.appendChild(item);
  });
}

// –°–û–ë–´–¢–ò–Ø
eye.onclick = () => {
  if (energy > 0) {
    score += clickMultiplier;
    energy--;
    totalClicks++;
    checkAchievements();
    updateUI();
    saveProgress();
    if (navigator.vibrate) navigator.vibrate(12);
  }
};

btnShop.onclick = () => { shop.style.display = 'block'; btnShop.style.display = 'none'; renderShop(); };
btnCloseShop.onclick = () => { shop.style.display = 'none'; btnShop.style.display = 'inline-block'; };

btnAch.onclick = () => { achPanel.style.display = 'block'; btnAch.style.display = 'none'; renderAchievements(); };
btnCloseAch.onclick = () => { achPanel.style.display = 'none'; btnAch.style.display = 'inline-block'; };

btnPrestige.onclick = () => { prestigePanel.style.display = 'block'; btnPrestige.style.display = 'none'; updatePrestigeUI(); };
btnClosePrestige.onclick = () => { prestigePanel.style.display = 'none'; btnPrestige.style.display = 'inline-block'; };

// –¢–ê–ô–ú–ï–†–´
setInterval(saveProgress, 8000);
setInterval(() => {
  const maxEnergy = getMaxEnergy();
  if (energy < maxEnergy) {
    energy += 1;
    updateUI();
    saveProgress();
  }
}, 3000);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—Ü–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
loadTraderItems();
renderInventory();

// –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω
createAnimatedBackground();

// –°–¢–ê–†–¢
updateUI();
renderShop();
renderAchievements();
updatePrestigeUI();
</script>
</body>
</html>